function e(e){const t=e<0?"-1":"",o=Math.abs(e),i=Math.log10(o)/3|0;if(0==i)return`${o}`;const r=["","KB","MB","GB","TB"][i],a=Math.pow(10,3*i);let n=(Math.floor(o/a*10)/10).toFixed(1);return n=/\.0$/.test(n)?n.substr(0,n.length-2):n,`${t}${n}${r}`}async function t(t){return new Promise((async i=>{try{if(!a(t)||!/drive\.google\.com/i.test(t))throw new Error("Invalid URL: "+t);const n=await function(e){return new Promise((async(t,i)=>{const r=await function(e){return new Promise(((t,i)=>{try{t(new o(e))}catch(e){i(e)}}))}(e);r.searchParams.has("id")&&t(r.searchParams.get("id"));const a=r.pathname.split("/"),n=a.findIndex((e=>"d"===e));-1===n?i(new TypeError(`Failed to extract id from url: ${e}`)):t(a[n+1])}))}(t),s=await r(`https://drive.google.com/uc?id=${n}&authuser=0&export=download`,{"method":"post","headers":{"accept-encoding":"gzip, deflate, br","content-length":0,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8","origin":"https://drive.google.com","user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36","x-client-data":"CKG1yQEIkbbJAQiitskBCMS2yQEIqZ3KAQioo8oBGLeYygE=","x-drive-first-party":"DriveWebUi","x-json-requested":"true"}}),{"fileName":l,"sizeBytes":d,"downloadUrl":m}=JSON.parse((await s.text()).slice(4));m||i({"message":"Link Download Limit!","downloadUrl":"","fileName":"","fileSize":"","mimetype":""});const c=await r(m);200!==c.status&&i({"msg":c.statusText,"downloadUrl":"","fileName":"","fileSize":"","mimetype":""}),i({"downloadUrl":m,"fileName":l,"fileSize":e(d),"mimetype":c.headers.get("content-type")})}catch(e){i({"msg":e?.message,"downloadUrl":"","fileName":"","fileSize":"","mimetype":""})}}))}import{URL as o}from"url";import i from"jsdom";import r from"node-fetch";const a=e=>/^https?:\/\//.test(e);export default t;