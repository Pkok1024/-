import r from"express";import e from"jsonwebtoken";import t from"../models/user.js";import o from"path";import{fileURLToPath as i}from"url";import{dirname as s}from"path";const a=s(i(import.meta.url)),n=r.Router();n.get("/verify/:token",(async(r,i)=>{try{const{"token":s}=r.params;if(!s)return i.status(400).json({"error":"Token not provided."});let n;try{n=e.verify(s,"Konbanwa")}catch(r){if("TokenExpiredError"===r.name&&"jwt expired"===r.message)return i.status(401).json({"error":"Email verification token has expired. Please request a new verification email."});throw r}const m=await t.findOne({"email":n.email});if(!m)return i.status(404).json({"error":"User not found."});if(m.isVerified)return i.status(400).json({"error":"User is already verified."});m.isVerified=!0,await m.save();const f=o.resolve(a,"../views/pages/assets/verification.html");i.sendFile(f)}catch(r){console.error("Error verifying email:",r),i.status(500).json({"error":"Internal Server Error"})}}));export default n;