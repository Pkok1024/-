import e from"express";import r from"axios";import{pixart as t}from"gpti";import{fetchJson as a,getBuffer as s}from"../../lib/function.js";import o from"../../middlewares/apiKeyMiddleware.js";const i=e.Router();i.get("/:feature",o,(async(e,a,s)=>{const{"feature":o}=e.params;try{switch(o){case"blackbox":const s=e.query.q;if(!s)return a.json({"error":"Missing query parameter."});const o="https://useblackbox.io/chat-request-v4",i={"textInput":s,"allMessages":[{"user":s}],"stream":"","clickedContinue":!1};((e,r)=>{e.json({"status":"Success","code":200,"author":author,"data":r})})(a,{"response":(await r.post(o,i)).data.response[0][0]});break;case"Pixart-A":const n=e.query.prompt,p={"prompt_negative":"","sampler":e.query.sampler,"image_style":e.query.style,"width":e.query.width,"height":e.query.height,"dpm_guidance_scale":4.5,"dpm_inference_steps":14,"sa_guidance_scale":3,"sa_inference_steps":25},u=await(async(e,r)=>{try{return await new Promise(((a,s)=>{t.a({"prompt":e,"data":r},((e,r)=>{e?s(e):a(r)}))}))}catch(e){throw new Error("Failed to process Pixart request.")}})(n,p);if(!(u&&u.images&&u.images.length>0))return a.json({"error":"No image found in the response."});{let e=u.images[0];e=e.replace(/^data:image\/jpeg;base64,/,""),a.contentType("image/jpeg"),a.send(Buffer.from(e,"base64"))}break;default:return a.status(404).json({"error":"Invalid feature."})}}catch(e){s(e)}}));export default i;